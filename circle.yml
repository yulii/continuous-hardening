machine:
  services:
    - docker

dependencies:
  pre:
    - docker build -t spec -f Dockerfile --no-cache .
    - docker run --name ci -it -d spec
test:
  pre:
    # - docker exec -it ci /bin/sh -c 'cd /usr/local/provisioning && itamae local roles/ci.rb'
    - docker inspect --format '' ci
    - sudo lxc-attach -n "$(docker inspect --format '' ci)" -- /bin/sh -c 'cd /usr/local/provisioning && itamae local roles/ci.rb'
  override:
    - sudo lxc-attach -n "$(docker inspect --format '' ci)" -- /bin/sh -c 'cd /usr/local/provisioning && rake spec'
